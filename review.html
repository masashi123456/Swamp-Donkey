<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reviews - SWAMP DONKEY</title>
    <meta name="author" content="David Lunceford, Masashi Ota, Ryan Griffin">
    <meta name="description" content="Customer reviews for Swamp Donkey Mobile Mechanic in Rexburg, ID.">
    <meta property="og:title" content="Swamp Donkey Reviews">
    <meta property="og:type" content="Web Page">
    <meta property="og:image" content="#">
    <meta property="og:url" content="https://github.com/masashi123456/Swamp-Donkey.git">

    <link rel="icon" href="images/swamp-favicon.png">
    <link rel="stylesheet" href="styles/base.css">
    <link rel="stylesheet" href="styles/consolidated.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="slide-in" id="review-image">
    <header>
        <a href="index.html">
            <img id="logo" src="images/SWAMP DONKEY.png" alt="company logo">
        </a>
    </header>
    <nav class="navbar">
        <a href="index.html">Home</a>
        <a href="quote.html">Quick Quote</a>
        <a href="services.html">Services</a>
        <a href="contact.html">Contact</a>
        <a href="review.html">Reviews</a>
        <a href="faq.html">FAQs</a>
    </nav>
    <main class="py-12 px-4 bg-site">
        <div class="max-w-4xl mx-auto space-y-12">
            <div class="review-form-card p-8">
                <h2 class="text-3xl font-bold text-center mb-6">Leave Us a Review</h2>
                <form id="reviewForm" class="space-y-6">
                    <div>
                        <label for="reviewerName" class="block font-medium text-black font-bold">Your Name</label>
                        <input type="text" id="reviewerName" name="reviewerName" required
                               class="mt-1 w-full px-3 py-2 border rounded-md shadow-sm focus:ring focus:border-accent">
                    </div>
                    <div>
                        <label class="block font-medium text-center mb-2 text-black font-bold">Your Rating</label>
                        <div id="starRating" class="star-rating">
                            <input type="radio" id="star5" name="rating" value="5" required/><label for="star5"><i class="fas fa-star"></i></label>
                            <input type="radio" id="star4" name="rating" value="4"/><label for="star4"><i class="fas fa-star"></i></label>
                            <input type="radio" id="star3" name="rating" value="3"/><label for="star3"><i class="fas fa-star"></i></label>
                            <input type="radio" id="star2" name="rating" value="2"/><label for="star2"><i class="fas fa-star"></i></label>
                            <input type="radio" id="star1" name="rating" value="1"/><label for="star1"><i class="fas fa-star"></i></label>
                        </div>


                    </div>
                    <div>
                    

                    <div>
                        <label for="reviewMessage" class="block font-medium">Review</label>
                        <textarea id="reviewMessage" name="reviewMessage" rows="4" required
                                  class="mt-1 w-full px-3 py-2 border rounded-md shadow-sm focus:ring focus:border-accent"></textarea>
                                  <label for="reviewImage" class="block font-medium">Upload an Image (optional)</label>
                        <input type="file" id="reviewImage" name="reviewImage" accept="image/*"class="mt-1 w-full">
                    </div>
                    <div class="text-center">
                        <button type="submit" class="submit-button font-bold py-3 px-8 rounded-lg shadow-lg">
                            Submit Review
                        </button>
                    </div>
                </form>
                <div id="confirmation-message" class="mt-6 text-center text-green-600 opacity-0 transform translate-y-2">
                    <p>Thank you! Your review has been submitted.</p>
                </div>
            </div>
            <div class="space-y-8">
                <h2 class="text-3xl font-bold text-center text-white">What Our Customers Are Saying</h2>
                <div id="reviewsContainer" class="space-y-6">
                </div>
            </div>
        </div>
    </main>
    <footer>
        <div class="foot">
            <p><a href="tel:+12085478375">üìû +1 208-547-8375</a></p>
            <p><a href="mailto:swampdonkeymobilemechanics@gmail.com">‚úâ swampdonkeymobilemechanics@gmail.com</a></p>
            <p>üìç <a href="https://www.google.com/maps/search/?api=1&query=235+S+4th+W+Rexburg%2C+ID+83440" target="_blank" rel="noopener">235 S 4th W Rexburg, ID 83440</a></p>
            <p id="lastModified"></p>
        </div>
        <div class="media">
            <a id="facebook" href="https://www.facebook.com/share/15zKQCcY5z/?mibextid=wwXIfr" target="_blank" rel="noopener" loading="lazy"><img src="images/fa.png" alt="facebook"></a>
            <a id="instagram" href="https://www.instagram.com/" target="_blank" rel="noopener" loading="lazy"><img src="images/insta.webp" alt="instagram"></a>
            <a id="x" href="https://x.com/?lang=en" target="_blank" rel="noopener" loading="lazy"><img src="images/x.webp" alt="x"></a>
        </div>
    </footer>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";
        const firebaseConfig = {
        apiKey: "AIzaSyDE4YNMlgZm9Uax_-zXLk3dHlYOWpftmw4",
        authDomain: "swamp-donkey-website-68780.firebaseapp.com",
        projectId: "swamp-donkey-website-68780",
        storageBucket: "swamp-donkey-website-68780.firebasestorage.appspot.com",
        messagingSenderId: "642498767447",
        appId: "1:642498767447:web:fe862e8ea7d93a0c9d9112"
        };



        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const reviewsRef = collection(db, "reviews");
        const storage = getStorage(app);

        const reviewForm = document.getElementById('reviewForm');
        const confirmationMessage = document.getElementById('confirmation-message');
        const reviewsContainer = document.getElementById('reviewsContainer');
        const imageFile = document.getElementById('reviewImage').files[0];

        reviewForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('reviewerName').value.trim();
            const rating = document.querySelector('input[name="rating"]:checked').value;
            const message = document.getElementById('reviewMessage').value.trim();

            if (!name || !rating || !message) {
                alert('Please fill out all fields.');
                return;
            }

            const imageFile = document.getElementById('reviewImage').files[0];
            let imageUrl = "";

            if (imageFile) {
                const storageRef = ref(storage, `review-images/${Date.now()}-${imageFile.name}`);
                const snapshot = await uploadBytes(storageRef, imageFile);
                imageUrl = await getDownloadURL(snapshot.ref);
            }

            await addDoc(reviewsRef, { name, rating: Number(rating), message, imageUrl, createdAt: new Date() });
            reviewForm.reset();
            confirmationMessage.style.opacity = '1';
            setTimeout(() => confirmationMessage.style.opacity = '0', 4000);

            

           
        });

        onSnapshot(query(reviewsRef, orderBy("createdAt", "desc")), (snapshot) => {
            reviewsContainer.innerHTML = '';
            snapshot.forEach((doc) => {
                const { name, rating, message, imageUrl } = doc.data();
                const reviewHTML = `<div class=\"review-card p-6\">
                    <div class=\"flex items-center mb-2\">
                        <p class=\"font-bold\">${name}</p>
                        <div class=\"ml-auto flex\">
                            ${[...Array(5)].map((_, i) => `<i class='fas fa-star ${i < rating ? 'text-amber-500' : 'text-gray-300'}'></i>`).join('')}
                        </div>
                    </div>
                    <p>${message}</p>
                    ${imageUrl ? `<img src="${imageUrl}" alt="Review Image" class="max-w-full rounded shadow-md mt-2"/>` : ''}
                </div>`;
                reviewsContainer.insertAdjacentHTML('beforeend', reviewHTML);
            });
        });
    </script>
</body>
</html>
